CREATE TABLE note (
    id SERIAL PRIMARY KEY,
    file_path TEXT NOT NULL,
    title TEXT,
    content TEXT NOT NULL,
    tags TEXT[],  -- ARRAY(Text)
    summary TEXT,
    created_at TIMESTAMP,
    last_summarized_at TIMESTAMP,
    last_embedded_at TIMESTAMP
);

CREATE TABLE blog (
    id SERIAL PRIMARY KEY,
    file_path TEXT NOT NULL,
    slug TEXT UNIQUE,
    title TEXT,
    body TEXT NOT NULL,
    author TEXT,
    published_at TIMESTAMP,
    tags TEXT[],  -- ARRAY(Text)
    summary TEXT,
    last_summarized_at TIMESTAMP,
    last_embedded_at TIMESTAMP
);

CREATE TABLE photo (
    id SERIAL PRIMARY KEY,
    file_path TEXT NOT NULL,
    caption TEXT,
    taken_at TIMESTAMP,
    location TEXT,
    camera_model TEXT,
    gps_lat DOUBLE PRECISION,
    gps_lng DOUBLE PRECISION,
    tags TEXT[],  -- ARRAY(Text)
    summary TEXT,
    last_summarized_at TIMESTAMP,
    last_embedded_at TIMESTAMP
);

-- 先安装 pgvector 扩展（只需一次）：
CREATE EXTENSION IF NOT EXISTS vector;

CREATE TABLE unified_embeddings (
    id SERIAL PRIMARY KEY,
    entry_type TEXT,          -- 'note' | 'blog' | 'photo'
    entry_id   INTEGER,       -- 对应实体 id
    text       TEXT,          -- 格式化后的知识片段
    embedding  vector(1024)    -- 这里写你的 embedding 维度
);

-- 推荐建索引加速检索：
CREATE INDEX ON unified_embeddings USING ivfflat (embedding vector_cosine_ops);